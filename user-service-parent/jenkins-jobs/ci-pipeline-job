def pomLocation = "user-service-parent"
def targetLocation = "user-service-parent/user-service/target"
def cucumberReport = "cucumber-report/cucumber-html-reports/cucumber-html-reports"

node {

  stage('Checkout') {
    checkout scm
  }
  stage('Build'){
      def pom = readMavenPom file: pomLocation+'/pom.xml'

  try {
      sh "mvn " + pomLocation + "/pom.xml clean install"
    } finally {
                junit targetLocation + '/surefire-reports/*.xml'

                publishHTML(target: [
                        allowMissing         : true,
                        alwaysLinkToLastBuild: false,
                        keepAll              : true,
                        reportDir            : targetLocation + '/pit-reports',
                        reportFiles          : 'index.html',
                        reportName           : "user-service pit report"
                ])

                publishHTML(target: [
                        allowMissing         : true,
                        alwaysLinkToLastBuild: false,
                        keepAll              : true,
                        reportDir            : testTargetLocation + '/' + cucumberReport,
                        reportFiles          : 'overview-features.html',
                        reportName           : "user-service cucumber report"
                ])
              }
    }
}